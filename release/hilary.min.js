/*! little-hilary 2017-04-01 */
if(function(a){"use strict";!function(a){try{if("undefined"!=typeof module&&module.exports)module.exports=a.factory;else{if("undefined"==typeof window)throw new Error("[HILARY] Unkown runtime environment");window.__hilary=window.__hilary||{},window.__hilary[a.name]=a.factory}}catch(d){var b=a&&a.name?a.name:"MISSING NAME",c=new Error("[HILARY] Registration failure: "+b);throw c.cause=d,c}}({name:"locale",factory:{errorTypes:{INVALID_ARG:"InvalidArgument",INVALID_REGISTRATION:"InvalidRegistration",MODULE_NOT_FOUND:"ModuleNotFound"},container:{CONSUMER_REQUIRED:"A consumer function is required to `enumerate` over a container"},hilaryModule:{FACTORY_UNDEFINED:"This implementation does not satisfy blueprint, Hilary::HilaryModule. It should have the property, factory.",DEPENDENCIES_NO_FACTORY:"Dependencies were declared, but the factory is not a function, so they cannot be applied.",DEPENDENCY_FACTORY_MISMATCH:"The number of dependencies that were declared does not match the number of arguments that the factory accepts."},api:{REGISTER_ERR:"register failed. see cause for more information",REGISTER_ARG:"register expects either a hilary module, or an array of hilary modules as the first argument, but instead saw this: ",RESOLVE_ARG:"resolve expects a moduleName (string) as the first argument, but instead saw this: ",MODULE_NOT_FOUND:'The module, "{{module}}", cannot be found',MODULE_NOT_FOUND_RELYING:', and is a dependency of, "{{startingModule}}"',REGISTRATION_BLACK_LIST:"A module was registered with a reserved name: ",PARENT_CONTAINER_ARG:"setParentScope expects the name of the parent scope, or an instance of Hilary"}}})}(),function(a){"use strict";function b(a){return{isException:!0,type:a.type,error:c(a),messages:d(a),data:a.data}}function c(a){return"object"==typeof a.error?a.error:"string"==typeof a.error?new Error(a.error):new Error}function d(a){return Array.isArray(a.messages)?a.messages:"string"==typeof a.messages?[a.messages]:a.error&&a.error.message?[a.error.message]:[]}!function(a){try{if("undefined"!=typeof module&&module.exports)module.exports=a.factory;else{if("undefined"==typeof window)throw new Error("[HILARY] Unkown runtime environment");window.__hilary=window.__hilary||{},window.__hilary[a.name]=a.factory}}catch(d){var b=a&&a.name?a.name:"MISSING NAME",c=new Error("[HILARY] Registration failure: "+b);throw c.cause=d,c}}({name:"Exception",factory:b})}(),function(a){"use strict";function b(a,b,c,d){return function(){function c(){return k}function e(a){k[a.name]=a}function f(a){return k[a]}function g(a){return k.hasOwnProperty(a)}function h(c){var e;if(!b.function(c))return new d({type:a.errorTypes.INVALID_ARG,error:new Error(a.container.CONSUMER_REQUIRED)});for(e in k)k.hasOwnProperty(e)&&c(e,k[e])}function i(a){var c,d,e,f,g={result:!0,failures:[]};if(b.string(a))return l.disposeOne(a);if(b.array(a)){for(d=0;d<a.length;d+=1)e=l.disposeOne(a[d]),g.result=g.result&&e,e||g.failures.push(a[d]);return g}if(a)return!1;f=!0;for(c in k)k.hasOwnProperty(c)&&(f=f&&l.disposeOne(c));return f}function j(a){return!!k[a]&&(delete k[a],!0)}var k={},l={get:c,register:e,resolve:f,exists:g,enumerate:h,dispose:i,disposeOne:j};return l}}!function(a){try{if("undefined"!=typeof module&&module.exports)module.exports=a.factory;else{if("undefined"==typeof window)throw new Error("[HILARY] Unkown runtime environment");window.__hilary=window.__hilary||{},window.__hilary[a.name]=a.factory}}catch(d){var b=a&&a.name?a.name:"MISSING NAME",c=new Error("[HILARY] Registration failure: "+b);throw c.cause=d,c}}({name:"Container",factory:b})}(),function(a){"use strict";function b(a,b){var c=new a({__blueprintId:"Hilary::Context",scope:"string",parent:{type:"string",required:!1},container:"object",singletonContainer:"object"});return function(a){var d;return a=a||{},d=new c({scope:a.scope,parent:a.parent,container:new b,singletonContainer:new b}),d.isException?d:(d.setParentScope=function(a){return c.merge({parent:a})},d)}}!function(a){try{if("undefined"!=typeof module&&module.exports)module.exports=a.factory;else{if("undefined"==typeof window)throw new Error("[HILARY] Unkown runtime environment");window.__hilary=window.__hilary||{},window.__hilary[a.name]=a.factory}}catch(d){var b=a&&a.name?a.name:"MISSING NAME",c=new Error("[HILARY] Registration failure: "+b);throw c.cause=d,c}}({name:"Context",factory:b})}(),function(a){"use strict";function b(a,b,c,d,e){var f=new b({__blueprintId:"Hilary::HilaryModule",isHilaryModule:"boolean",name:"string",singleton:{type:"boolean",required:!1},dependencies:{type:"array",required:!1},factory:{validate:function(b,c,e){a.not.defined(b)?c.push(d.hilaryModule.FACTORY_UNDEFINED):a.not.function(b)&&a.array(e.dependencies)&&e.dependencies.length?c.push(d.hilaryModule.DEPENDENCIES_NO_FACTORY):a.function(b)&&a.array(e.dependencies)&&e.dependencies.length&&b.length!==e.dependencies.length&&c.push(d.hilaryModule.DEPENDENCY_FACTORY_MISMATCH)}}});return function(b){return b=b||{},b.isHilaryModule=!0,b.singleton=!a.boolean(b.singleton)||b.singleton,a.not.defined(b.dependencies)&&a.function(b.factory)?b.dependencies=c.getArgumentNames(b.factory):b.dependencies===!1&&(b.dependencies=[]),f.validate(b).result?b:new e({type:d.errorTypes.INVALID_REGISTRATION,error:new Error(d.api.REGISTER_ARG+JSON.stringify(b)),messages:f.validate(b).errors,data:b})}}!function(a){try{if("undefined"!=typeof module&&module.exports)module.exports=a.factory;else{if("undefined"==typeof window)throw new Error("[HILARY] Unkown runtime environment");window.__hilary=window.__hilary||{},window.__hilary[a.name]=a.factory}}catch(d){var b=a&&a.name?a.name:"MISSING NAME",c=new Error("[HILARY] Registration failure: "+b);throw c.cause=d,c}}({name:"HilaryModule",factory:b})}(),function(a){"use strict";function b(a){function b(b){var c,d;if(b="string"==typeof b?{}:b||{},b.logging=b.logging||{},b.logging.level&&a.string(b.logging.level))switch(b.logging.level){case"debug":c=20;break;case"info":c=30;break;case"warn":c=40;break;case"error":c=50;break;case"fatal":c=60;break;case"off":c=70;break;default:c=10}else c=b.logging.level&&a.number(b.logging.level)&&b.logging.level>0&&b.logging.level<=70?b.logging.level:30;return d=a.function(b.logging.log)?b.logging.log:null,{level:c,log:d}}return function(a){function c(b,c){var d;if(a.log)return a.log(b,c);if(!(b<a.level)){switch(b){case 60:d=console.error||console.log;break;case 50:d=console.error||console.log;break;case 40:d=console.warn||console.log;break;default:d=console.log}d.apply(null,c)}}var d={trace:function(){c(10,arguments)},debug:function(){c(20,arguments)},info:function(){c(30,arguments)},warn:function(){c(40,arguments)},error:function(){c(50,arguments)},fatal:function(){c(60,arguments)}};return a=new b(a),d}}!function(a){try{if("undefined"!=typeof module&&module.exports)module.exports=a.factory;else{if("undefined"==typeof window)throw new Error("[HILARY] Unkown runtime environment");window.__hilary=window.__hilary||{},window.__hilary[a.name]=a.factory}}catch(d){var b=a&&a.name?a.name:"MISSING NAME",c=new Error("[HILARY] Registration failure: "+b);throw c.cause=d,c}}({name:"Logger",factory:b})}(),function(a){"use strict";function b(a,b,k,l,m,n,o,p,q){var r,s,t={};return r=function(e){function f(a,c){var d=new Error(m.api.REGISTER_ERR);if(b.object(a))return G.trace("[TRACE] registering a single module:",a),h(a,d,c);if(b.array(a))return G.trace("[TRACE] registering an array of modules:",a),z(function(){return a.forEach(h),C},d,c);var e=new o({type:m.errorTypes.INVALID_ARG,error:new Error(m.api.REGISTER_ARG+JSON.stringify(a)),data:a});return G.trace("[TRACE] registration failed:",e),E(e),e}function h(c,d,e){var f=[];if(f.push(function(a){var b=new q(c);return b.isException?(G.trace("[TRACE] Invalid registration model:",b),a(new o({type:m.errorTypes.INVALID_REGISTRATION,error:new Error(b.error.message),messages:b.messages,data:c}))):(G.trace("[TRACE] Successfully bound to HilaryModule:",b.name),a(null,b))}),f.push(function(a,b){a.name===g&&(G.trace("[TRACE] Error handler reset"),F=null),b(null,a)}),f.push(function(a,b){D.container.register(a),G.trace("[TRACE] Module registered on container",a.name),b(null,a)}),b.function(e))return a.waterfall(f,function(a,b){if(a)return G.trace("[TRACE] Registration failed:",c,a),E(a),e(a);G.trace("[TRACE] Registration success:",b.name),e(a,b)});var h;return a.waterfall(f,{blocking:!0},function(a,b){if(a)return G.trace("[TRACE] Registration failed:",c,a),h=a,void E(a);G.trace("[TRACE] Registration success:",b.name),h=b}),h}function i(a,b){return G.trace("[TRACE] resolving:",a),j(a,a,b)}function j(c,e,f){var g={context:D,config:H,name:c,relyingName:e},h=[];if(h.push(function(a){a(null,g)}),h.push(function(a,c){b.string(a.name)?(G.trace("[TRACE] module name is valid:",a.name),c(null,a)):(G.trace("[TRACE] module name is INVALID:",a.name),c(new o({type:m.errorTypes.INVALID_ARG,error:new Error(m.api.RESOLVE_ARG+JSON.stringify(a.name))})))}),h.push(function(a,b){var c;a.context.singletonContainer.exists(a.name)?(G.trace("[TRACE] found singleton for:",a.name),a.resolved=D.singletonContainer.resolve(a.name).factory,a.isResolved=!0,a.registerSingleton=!1,b(null,a)):D.container.exists(a.name)?(G.trace("[TRACE] found factory for:",a.name),a.theModule=D.container.resolve(a.name),b(null,a)):(G.trace("[TRACE] module not found:",a.name),c=m.api.MODULE_NOT_FOUND.replace("{{module}}",a.name),a.name!==a.relyingName&&(c+=m.api.MODULE_NOT_FOUND_RELYING.replace("{{startingModule}}",a.relyingName)),b(new o({type:m.errorTypes.MODULE_NOT_FOUND,error:new Error(c),data:{moduleName:a.name,relyingModuleName:a.relyingName}})))}),h.push(function(c,d){var e;return G.trace("[TRACE] resolving dependencies for:",c.name),c.isResolved?d(null,c):b.array(c.theModule.dependencies)&&c.theModule.dependencies.length>0?(G.trace("[TRACE] resolving with dependencies array:",c.theModule.dependencies.join(", ")),e=c.theModule.dependencies.map(function(a){return function(b,c,d){var e=i(a,c);return e?e.isException?(G.trace("[TRACE] the following dependency returned an exception:",a),d(e)):(G.trace("[TRACE] the following dependency was resolved:",a),b.push(e),void d(null,b,c)):(G.warn("[WARN] the following dependency was not resolved:",a),d(null,b,c))}}),e.unshift(function(a){a(null,[],c.relyingName)}),a.waterfall(e,{blocking:!0},function(a,b){if(a)return G.trace("[TRACE] at least one dependency was not found for:",c.name,a),d(a);c.resolved=new(Function.prototype.bind.apply(c.theModule.factory,[null].concat(b))),c.registerSingleton=c.theModule.singleton,c.isResolved=!0,G.trace("[TRACE] dependencies resolved for:",c.name),d(null,c)})):(b.function(c.theModule.factory)&&0===c.theModule.factory.length?(G.trace("[TRACE] the factory is a function and takes no arguments, returning the result of executing it:",c.name),c.resolved=new(Function.prototype.bind.apply(c.theModule.factory,[null]))):(G.trace("[TRACE] the factory takes arguments and has no dependencies, returning the function as-is:",c.name),c.resolved=c.theModule.factory),c.registerSingleton=c.theModule.singleton,c.isResolved=!0,void d(null,c))}),h.push(function(a,b){a.registerSingleton&&(G.trace("[TRACE] registering the resolved module as a singleton: ",a.name),D.singletonContainer.register({name:a.name,factory:a.resolved})),b(null,a)}),h.push(function(a,b){G.trace("[TRACE] binding the module to the output:",a.name),b(null,a.resolved)}),!b.function(f)){var j;return a.waterfall(h,{blocking:!0},function(a,b){if(a&&a.type===m.errorTypes.MODULE_NOT_FOUND&&D.parent&&t[D.parent])return G.trace("[TRACE] attempting to resolve the module, "+g.name+", on the parent scope:",D.parent),void(j=t[D.parent].resolve(c));if(a&&a.type===m.errorTypes.MODULE_NOT_FOUND){G.trace("[TRACE] attempting to gracefully degrade, "+g.name);var e=d(g.name);if(e)return void(j=e)}if(a)return G.trace("[TRACE] resolve failed for:",g.name,a),E(a),void(j=a);G.trace("[TRACE] module resolved:",g.name),j=b}),j}a.waterfall(h,function(a,b){if(a&&a.type===m.errorTypes.MODULE_NOT_FOUND&&D.parent&&t[D.parent])return G.trace("[TRACE] attempting to resolve the module, "+g.name+", on the parent scope:",D.parent),t[D.parent].resolve(c,f);if(a&&a.type===m.errorTypes.MODULE_NOT_FOUND){G.trace("[TRACE] attempting to gracefully degrade, "+g.name);var e=d(g.name);if(e)return f(null,e)}if(a)return G.trace("[TRACE] resolve failed for:",g.name,a),E(a),f(a);G.trace("[TRACE] module resolved:",g.name),f(null,b)})}function l(a){return G.trace("[TRACE] checking if module exists:",a),D.container.exists(a)}function s(a,b){return G.trace("[TRACE] disposing module(s):",a),z(function(){return D.container.dispose(a)&&D.singletonContainer.dispose(a)},b)}function u(a,b,c){return a=a||k.createUid(8),b=b||{},b.parent=w(b.parent||C),t[a]?G.trace("[TRACE] returning existing scope:",a):G.trace("[TRACE] creating new scope:",a,b),z(function(){return r.scope(a,b)},new Error,c)}function v(a){var b=w(a);return b?(G.trace("[TRACE] setting the parent scope of, "+C.context.scope+", to:",b),D=D.setParentScope(b)):(G.trace("[TRACE] unable to set the parent scope of, "+C.context.scope+", to:",b),new o({type:m.errorTypes.INVALID_ARG,error:new Error(m.api.PARENT_CONTAINER_ARG)}))}function w(a){return a?b.string(a)?a:a.__isHilaryScope?a.context.scope:null:null}function x(c,d){var e,f=[];c=c||{},b.function(c.onComposed)?(G.trace("[TRACE] using onComposed as the callback for the bootstrapper (ignores the callback argument) for:",C.context.scope),e=c.onComposed):b.function(d)?(G.trace("[TRACE] using the callback argument for the bootstrapper for:",C.context.scope),e=d):(G.trace("[TRACE] a callback was not defined for the bootstrapper for:",C.context.scope),e=function(a){a&&G.fatal(a)}),f.push(function(a){a(null,C)}),b.function(c.composeModules)&&(G.trace("[TRACE] composing modules for:",C.context.scope),f.push(c.composeModules)),a.waterfall(f,e)}function y(){return{throw:function(a){G.error(a)}}}function z(c,d,e){if(!b.function(e))return A(c,d);a.runAsync(function(){var a=A(c,d);a.isException?e(d):e(null,a)})}function A(a,b){try{return a()}catch(a){return b.message+="("+a.message+")",b.cause=a,E(b),{err:b,isException:!0}}}function B(a){var c={};return a=a||{},b.string(a)?c.scope=a:b.nullOrUndefined(a.scope)&&(b.string(a.name)?c.scope=a.name:c.scope=k.createUid(8)),c.logging=a.logging||{level:30},b.string(a.parent)?c.parent=a.parent:a.parent&&a.parent.__isHilaryScope&&(c.parent=a.parent.context.scope),c}var C,D,E,F,G=new n(e),H=new B(e);return D=new p(H),D.isException?D:(C={register:f,resolve:i,exists:l,dispose:s,bootstrap:x,scope:u,setParentScope:v},c(C,"__isHilaryScope",!0),c(C,"context",D),c(C,"HilaryModule",q),t[H.scope]=C,E=function(b){a.runAsync(function(){var a;a=b.isException?b:new o({type:"UNKNOWN",error:b}),y().throw(a)},!0)},C)},r.scope=function(a,b){return t[a]?t[a]:(b=b||{},b.name=a,t[a]=new r(b),t[a])},s=r.scope("default"),s.Context=p,s.context.singletonContainer.register({name:e,factory:a}),s.context.singletonContainer.register({name:f,singleton:!1,factory:function(){return s.context}}),s.context.singletonContainer.register({name:h,factory:l}),s.context.singletonContainer.register({name:i,factory:b}),s.context.singletonContainer.register({name:j,factory:function(){return s.context.parent}}),s}function c(a,b,c){Object.defineProperty(a,b,{enumerable:!1,configurable:!1,get:function(){return c},set:function(){console.log(b+" is read only")}})}function d(a){if("undefined"!=typeof module&&module.exports&&require)try{return require(a)}catch(a){return null}else if("undefined"!=typeof window)return window[a]}var e="polyn::async",f="hilary::context",g="hilary::error-handler",h="polyn::Immutable",i="polyn::is",j="hilary::parent";!function(a){try{if("undefined"!=typeof module&&module.exports)module.exports=a.factory;else{if("undefined"==typeof window)throw new Error("[HILARY] Unkown runtime environment");window.__hilary=window.__hilary||{},window.__hilary[a.name]=a.factory}}catch(d){var b=a&&a.name?a.name:"MISSING NAME",c=new Error("[HILARY] Registration failure: "+b);throw c.cause=d,c}}({name:"HilaryApi",factory:b})}(),"undefined"!=typeof module&&module.exports){var polyn=require("polyn"),locale=require("./locale"),Exception=require("./Exception"),Container=require("./Container")(locale,polyn.is,polyn.Immutable,Exception),Context=require("./Context")(polyn.Immutable,Container),HilaryModule=require("./HilaryModule")(polyn.is,polyn.Blueprint,polyn.objectHelper,locale,Exception),Logger=require("./Logger")(polyn.is),hilary=require("./HilaryApi")(polyn.async,polyn.is,polyn.id,polyn.Immutable,locale,Logger,Exception,Context,HilaryModule);polyn.Blueprint.configure({compatibility:"2017-03-20"}),module.exports=hilary}else{if("undefined"==typeof window)throw new Error("[HILARY] Unkown runtime environment");if(!window.polyn)throw new Error("[HILARY] Hilary depends on polyn. Make sure it is included before loading Hilary (https://github.com/losandes/polyn)");if(!window.__hilary)throw new Error("[HILARY] Hilary modules were loaded out of order");!function(a,b,c){"use strict";var d=b.locale,e=b.Exception,f=b.Container(d,a.is,a.Immutable,e),g=b.Context(a.Immutable,f),h=b.HilaryModule(a.is,a.Blueprint,a.objectHelper,d,e),i=b.Logger(a.is);a.Blueprint.configure({compatibility:"2017-03-20"}),c.hilary=b.HilaryApi(a.async,a.is,a.id,a.Immutable,d,i,e,g,h)}(window.polyn,window.__hilary,window)}